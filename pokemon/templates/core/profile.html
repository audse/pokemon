{% extends "base.html" %}
{% load staticfiles %}
{% load partition %}

{% block title %}{{ current_user.username}}'s Profile{% endblock %}

{% block content %}

<div class="col-sm-1"></div>
<div class="col-sm-7">
	<h1 class="gray oswald">{{ current_user.username }}'s Profile</h1>
	<div class="row">

		<div class="col-sm-6">
			{% for adopt in adopts|partition:"2"|first %}
				<div class="party-space">
					{% if adopt.hatched %}
						<div class="party-space-content">
							<img src="{% static 'img/pokemon/' %}{% if adopt.shiny %}shiny/{% endif %}{{ adopt.pokemon.number }}.png" style="float:left;" />
							<h4 class="blue open-sans"><a href="{% url 'view_adopt' pk=adopt.pk %}">
							{% if adopt.nickname %}
								{{ adopt.nickname }}
							{% else %}
								{{ adopt.pokemon.name }}
							{% endif %}
							</a></h4>
							{% if adopt.percent != 100 %}
							<span id="exp-{{ adopt.pk }}">{{ adopt.exp }}</span> {% if adopt.total_exp != 0 %}/ {{ adopt.total_exp }}{% endif %}
							{% else %}
							<span id="percent-{{ adopt.pk }}">{{ adopt.percent }}</span>%
							{% endif %}
							<div class="progress">
							 	<div class="progress-bar small" role="progressbar" style="{% if adopt.total_exp %}width:{{ adopt.percent }}%;{% else %}width:100%{% endif %}"></div>
							</div>

							<div style="clear:both"></div>
						</div>
						{% include 'includes/interact_pokemon.html' %}
					{% else %}
						<div class="party-space-content">
							<img src="{% static 'img/eggs/' %}{{ adopt.pokemon.number }}.png" style="float:left;" />

							<h4 class="blue open-sans"><a href="{% url 'view_adopt' pk=adopt.pk %}">Egg</a></h4>

							<span id="exp-{{ adopt.pk }}">{{ adopt.exp }}</span> / {{ adopt.pokemon.ehp }}
							<div class="progress">
							 	<div class="progress-bar small" role="progressbar" style="width:{{ adopt.percent }}%;" aria-valuenow="{{ adopt.exp }}" aria-valuemin="0" aria-valuemax="{{ adopt.pokemon.ehp }}"></div>
							</div>

							<div style="clear:both"></div>
						</div>
						{% include 'includes/interact_egg.html' %}
				{% endif %}
				</div>
			{% endfor %}
		</div>

		<div class="col-sm-6">
			{% for adopt in adopts|partition:"2"|last %}
				<div class="party-space">
					{% if adopt.hatched %}
						<div class="party-space-content">
							<img src="{% static 'img/pokemon/' %}{% if adopt.shiny %}shiny/{% endif %}{{ adopt.pokemon.number }}.png" style="float:left;" />
							<h4 class="blue open-sans"><a href="{% url 'view_adopt' pk=adopt.pk %}">
							{% if adopt.nickname %}
								{{ adopt.nickname }}
							{% else %}
								{{ adopt.pokemon.name }}
							{% endif %}
							</a></h4>
							{% if adopt.percent != 100 %}
							<span id="exp-{{ adopt.pk }}">{{ adopt.exp }}</span> {% if adopt.total_exp != 0 %}/ {{ adopt.total_exp }}{% endif %}
							{% else %}
							<span id="percent-{{ adopt.pk }}">{{ adopt.percent }}</span>%
							{% endif %}
							<div class="progress">
							 	<div class="progress-bar small" role="progressbar" style="{% if adopt.total_exp %}width:{{ adopt.percent }}%;{% else %}width:100%{% endif %}"></div>
							</div>

							<div style="clear:both"></div>
						</div>
						{% if adopt.can_interact %}
						<div class="party-space-berries">
							<a 
								href="{% url 'interact' username=adopt.owner.username pk=adopt.pk %}{% if adopt.favorite == 'sour' %}?berry=favorite{% elif adopt.disliked == 'sour' %}?berry=disliked{% endif %}" 

								class="berry {% if adopt.favorite == 'sour' %}berry-favorite{% endif %} {% if adopt.disliked == 'sour' %}berry-disliked{% endif %}">
								<img src="{% static 'img/items/sitrus-berry.png' %}" />
							</a>
							<a 
								href="{% url 'interact' username=adopt.owner.username pk=adopt.pk %}{% if adopt.favorite == 'spicy' %}?berry=favorite{% elif adopt.disliked == 'spicy' %}?berry=disliked{% endif %}" 

								class="berry {% if adopt.favorite == 'spicy' %}berry-favorite{% endif %} {% if adopt.disliked == 'spicy' %}berry-disliked{% endif %}">
								<img src="{% static 'img/items/leppa-berry.png' %}" />
							</a>
							<a 
								href="{% url 'interact' username=adopt.owner.username pk=adopt.pk %}{% if adopt.favorite == 'dry' %}?berry=favorite{% elif adopt.disliked == 'dry' %}?berry=disliked{% endif %}" 

								class="berry {% if adopt.favorite == 'dry' %}berry-favorite{% endif %} {% if adopt.disliked == 'dry' %}berry-disliked{% endif %}">
								<img src="{% static 'img/items/chesto-berry.png' %}" />
							</a>
							<a 
								href="{% url 'interact' username=adopt.owner.username pk=adopt.pk %}{% if adopt.favorite == 'sweet' %}?berry=favorite{% elif adopt.disliked == 'sweet' %}?berry=disliked{% endif %}" 

								class="berry {% if adopt.favorite == 'sweet' %}berry-favorite{% endif %} {% if adopt.disliked == 'sweet' %}berry-disliked{% endif %}">
								<img src="{% static 'img/items/kasib-berry.png' %}" />
							</a>
							<a 
								href="{% url 'interact' username=adopt.owner.username pk=adopt.pk %}{% if adopt.favorite == 'bitter' %}?berry=favorite{% elif adopt.disliked == 'bitter' %}?berry=disliked{% endif %}" 

								class="berry {% if adopt.favorite == 'bitter' %}berry-favorite{% endif %} {% if adopt.disliked == 'bitter' %}berry-disliked{% endif %}">
								<img src="{% static 'img/items/nanab-berry.png' %}" />
							</a>
						</div>
						{% else %}
							<div style="padding-bottom: 10px; text-align: center">
								{% if not user.is_authenticated %}
								<i class="gray" style="padding: 10px;">Please log in to interact.</i><br />
								{% else %}
								<i class="gray" style="padding: 10px;">Thank you!</i><br />
								{% endif %}
							</div>
						{% endif %}
					{% else %}
						<div class="party-space-content">
							<img src="{% static 'img/eggs/' %}{{ adopt.pokemon.number }}.png" style="float:left;" />

							<h4 class="blue open-sans"><a href="{% url 'view_adopt' pk=adopt.pk %}">Egg</a></h4>

							<span id="exp-{{ adopt.pk }}">{{ adopt.exp }}</span> / {{ adopt.pokemon.ehp }}
							<div class="progress">
							 	<div class="progress-bar small" role="progressbar" style="width:{{ adopt.percent }}%;" aria-valuenow="{{ adopt.exp }}" aria-valuemin="0" aria-valuemax="{{ adopt.pokemon.ehp }}"></div>
							</div>

							<div style="clear:both"></div>
						</div>
						<div id="interaction-{{ adopt.pk }}">
							{% if adopt.can_interact %}
								<form id="interact-form-{{ adopt.pk }}">{% csrf_token %}
									<button class="party-space-button" type="submit" style="width:100%">Hold the egg</button>
								</form>
							{% else %}
								<div style="padding-bottom: 10px; text-align: center">
									{% if not user.is_authenticated %}
									<i class="gray" style="padding: 10px;">Please log in to interact.</i><br />
									{% else %}
									<i class="gray" style="padding: 10px;">Thank you!</i><br />
									{% endif %}
								</div>
							{% endif %}
						</div>
				{% endif %}
				</div>


				<script type="text/javascript">
					$(document).ready(function(){
				    	$("#interact-form-{{ adopt.pk }}").submit(function(){
						    event.preventDefault();

						    $.ajax({
						        url: '{% url 'interact' username=current_user.username pk=adopt.pk %}',
						        type: 'POST',
						        data: $(this).serialize(),
						        success: function(data) {
						            // Whatever you want
						            $("#interaction-{{ adopt.pk }}").html('<div style="padding-bottom: 10px; text-align: center"><i class="gray" style="padding: 10px;">Thank you!</i><br /></div>');
						            // $("#exp-{{ adopt.pk }}").fadeOut(800, function(){
						            	// $("#exp-{{ adopt.pk }}").html("{{ adopt.exp }}").fadeIn().delay(2000);
						            // });
						            $("#exp-{{ adopt.pk }}").load(document.URL + ' #exp-{{ adopt.pk }}');
						            // $("#exp-{{ adopt.pk }}").html('{{ adopt.exp }}');
						        }
						    });
						});
					});
				</script>

			{% endfor %}
		</div>

	</div>
</div>
<div class="col-sm-3">
	{% if user.username == current_user.username %}
	{% if user.is_superuser %}
		<br /><br /><br /><br />
		<h4 class="gray">What are you up to?</h4>
		<form action="{% url 'manually_update_online' %}" method="POST">
			{% csrf_token %}
			<div class="form-group">
				<div class="input-group">
					<span class="input-group-addon input-group-addon" id="basic-addon1"><i class="fa fa-user"></i></span>
					<input type="text" class="form-control" name="action" placeholder="I am..." />
				</div>
			</div>
			<button class="btn btn-secondary" type="submit">Go</button>
		</form>
	{% endif %}
	{% endif %}
</div>
<div class="col-sm-1"></div>

{% endblock %}